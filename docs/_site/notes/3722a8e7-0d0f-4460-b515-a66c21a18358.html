<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Ch03 - Storage and Retrieval - Angela's note universe</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Ch03 - Storage and Retrieval | Angelaâ€™s note universe</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Ch03 - Storage and Retrieval" /> <meta name="author" content="Angela Ruohan Wang" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="This is where I keep and share my notes on books, tech, travel, and other hobbies :)" /> <meta property="og:description" content="This is where I keep and share my notes on books, tech, travel, and other hobbies :)" /> <link rel="canonical" href="http://localhost:4000/notes/3722a8e7-0d0f-4460-b515-a66c21a18358.html" /> <meta property="og:url" content="http://localhost:4000/notes/3722a8e7-0d0f-4460-b515-a66c21a18358.html" /> <meta property="og:site_name" content="Angelaâ€™s note universe" /> <meta property="og:image" content="http://localhost:4000/assets/images/logo.png" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:image" content="http://localhost:4000/assets/images/logo.png" /> <meta property="twitter:title" content="Ch03 - Storage and Retrieval" /> <meta name="twitter:site" content="@angelaw_ruohan" /> <meta name="twitter:creator" content="@Angela Ruohan Wang" /> <script type="application/ld+json"> {"@type":"WebPage","url":"http://localhost:4000/notes/3722a8e7-0d0f-4460-b515-a66c21a18358.html","image":"http://localhost:4000/assets/images/logo.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"Angela Ruohan Wang"},"author":{"@type":"Person","name":"Angela Ruohan Wang"},"headline":"Ch03 - Storage and Retrieval","description":"This is where I keep and share my notes on books, tech, travel, and other hobbies :)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item active"><a href="http://localhost:4000/" class="nav-list-link active">Root</a><ul class="nav-list"><li class="nav-list-item active"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/d088ab77-c2f6-4f7a-be4a-7597b00daff0.html" class="nav-list-link active">Books</a><ul class="nav-list"><li class="nav-list-item active"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/ede45f4d-8d30-42a9-bd27-f1b3ba37d6e0.html" class="nav-list-link active">Tech</a><ul class="nav-list"><li class="nav-list-item active"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/a42eba1d-b978-4cdc-9160-1f3e9c7cf025.html" class="nav-list-link active">Designing Data-intensive Applications</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/45199987-a515-40d0-8bc8-c447503f21b1.html" class="nav-list-link">Ch02 - Data Models and Query Languages</a></li><li class="nav-list-item active"><a href="http://localhost:4000/notes/3722a8e7-0d0f-4460-b515-a66c21a18358.html" class="nav-list-link active">Ch03 - Storage and Retrieval</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/e22dd5a3-f940-4548-b1d7-22a26b5386ce.html" class="nav-list-link">Ch04 - Encoding and evolution</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/28cfed31-0166-4784-a7d6-c76d3fcd269e.html" class="nav-list-link">Ch05 - Replication</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/c61cfa31-05a8-47de-897d-0fbd0a884e69.html" class="nav-list-link">Ch06 - Partitioning</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/603d252d-91ec-4f35-950e-26211cd5112a.html" class="nav-list-link">Ch07 - Transactions</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/e9abdfa6-2451-442e-a681-5165daba5f36.html" class="nav-list-link">Ch08 - Problems with distributed systems</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/b0ec61b7-70af-48f2-8c44-df56afab8f5d.html" class="nav-list-link">Ch10 - Batch processing</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/notes/d33e7310-3439-469d-9ba7-67cbf94f529b.html" class="nav-list-link">Domain-driven Design Distilled</a></li></ul></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/b0e90360-9cfe-47a5-b978-d007c2f1f305.html" class="nav-list-link">Courses</a><ul class="nav-list"><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/8d510207-4138-4032-a284-28fa028e7c2b.html" class="nav-list-link">GIS</a><ul class="nav-list"><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/361e2dd0-1ffb-4497-b812-18984976daf7.html" class="nav-list-link">Foundamentals of GIS</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/4944904a-3fb3-4916-8a08-319e0de5d058.html" class="nav-list-link">Qgis</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/fcbd17a1-8969-4026-9319-128703eeb871.html" class="nav-list-link">Resources</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/4cb91877-d9b8-48e7-bf3f-c8e082c34701.html" class="nav-list-link">Tools & Formats</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/ae4197f7-ef66-4d95-8500-f54327559d1d.html" class="nav-list-link">Week1 - Intro</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/d9b98137-dd44-478a-a7d0-5831287cfdbc.html" class="nav-list-link">Week2 - ArcGIS Basics</a></li></ul></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/d4747935-416b-44ef-abe2-c472208aa31b.html" class="nav-list-link">Investments II</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/683498b7-eb79-4363-8ec7-bbbf909e9ba5.html" class="nav-list-link">Week 1</a></li></ul></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/3cce73ba-3a76-4ee2-80e9-a4b338e1360c.html" class="nav-list-link">Frameworks</a><ul class="nav-list"><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/b26ba764-c2c2-4d3f-93b6-2fde6e596463.html" class="nav-list-link">Big data</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/270884d9-210b-42e0-88a3-7193738d3233.html" class="nav-list-link">Apache Beam</a></li></ul></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/5cda1053-d80d-49ca-8433-c0abaac2f632.html" class="nav-list-link">Hobbies</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/e64b6f7d-e6b5-4528-9b0e-f91965791ca0.html" class="nav-list-link">Cooking</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/b5bec914-8e1c-441c-80d2-f152cbc25367.html" class="nav-list-link">Sewing</a></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/3caaca75-734b-4ed3-a82e-ee73438b60ab.html" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/5d1093c0-c427-4f73-99bc-4d93fe865e82.html" class="nav-list-link">Unix</a></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/596743fc-6d97-4658-9cc5-916152eefd35.html" class="nav-list-link">Tag</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/f17a0af2-4b92-4464-ba66-f5eea84b5bd6.html" class="nav-list-link">Rust</a></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/bee70da8-e282-4d98-9709-1bad45e8a734.html" class="nav-list-link">Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/a943fdf0-9f93-40f9-8d93-09304935dd44.html" class="nav-list-link">Api Design</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/3bf41e97-8aeb-4462-bb76-168cebb241b4.html" class="nav-list-link">Graphql</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/notes/edcb01a7-1033-41f2-9428-9c3034fdc066.html" class="nav-list-link">Architecture</a></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/48575b62-61b9-4ee8-be31-67c48966a2fe.html" class="nav-list-link">Cloud</a><ul class="nav-list"><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/1c8375cc-9127-4509-9601-7748e3669ffd.html" class="nav-list-link">Aws</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/36636d89-cff6-43b1-baa9-e0db120a117a.html" class="nav-list-link">Deployment</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/626e1dd7-6f6f-45aa-bf72-faca04b22244.html" class="nav-list-link">Governance</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/02421f98-cab3-4955-9175-9db60819e5f1.html" class="nav-list-link">Lambda</a></li></ul></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/27ffe8ae-20ff-4850-a31e-aafff2c30b3f.html" class="nav-list-link">Distributed Systems</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/7ec6a7fa-7000-45e0-bec0-e3aa2e3493c5.html" class="nav-list-link">Async job scheduling</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/70076aa3-4564-4d29-8559-c766fa201698.html" class="nav-list-link">Google BigTable</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/5a064f50-f1fe-4fa0-8234-bc626fea65a8.html" class="nav-list-link">Orchestration</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/d388fa7b-7a1f-4030-8c7d-b92c8e982490.html" class="nav-list-link">Scheduler</a></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/056961d3-aba0-4fc6-ba6f-598dbc38294c.html" class="nav-list-link">Machine Learning</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/c23cc850-fa67-44ac-93df-bab59ef41f46.html" class="nav-list-link">Algorithmic Fairness</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/ee5aabfa-c76b-465e-8a60-63a8b391d6b4.html" class="nav-list-link">Inference accelerator</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/6011ad5f-c0b5-43f3-a3a0-cd6a09611c28.html" class="nav-list-link">ML and technical debt</a></li><li class="nav-list-item"><a href="http://localhost:4000/notes/d4dd9201-c58d-4f4d-aa38-498c8c6e6267.html" class="nav-list-link">Survival Analysis</a></li></ul></li><li class="nav-list-item"><a href="" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/notes/5d647f04-cc3d-45fd-8fcc-6f4f67671952.html" class="nav-list-link">Tech Adoption</a><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/notes/fbfe00ff-109f-4d84-8e62-22298363c305.html" class="nav-list-link">Building tech standards at AWS</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/notes/d12b00d4-6ba1-4505-8472-b729e901ba48.html" class="nav-list-link">Testing</a></li></ul></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/assets/images/2020-12-19-14-39-52.png.html" class="nav-list-link">Png</a></li><li class="nav-list-item"><a href="http://localhost:4000/assets/images/2020-12-19-15-53-59.png.html" class="nav-list-link">Png</a></li></ul></nav> <footer class="site-footer"> ðŸŒ± with ðŸ’• using <a href="https://www.dendron.so/"> Dendron ðŸŒ² </a> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Angela's note universe" aria-label="Search Angela's note universe" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/">Root</a></li><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/notes/d088ab77-c2f6-4f7a-be4a-7597b00daff0.html">Books</a></li><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/notes/ede45f4d-8d30-42a9-bd27-f1b3ba37d6e0.html">Tech</a></li><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/notes/a42eba1d-b978-4cdc-9160-1f3e9c7cf025.html">Designing Data-intensive Applications</a></li><li class="breadcrumb-nav-list-item">Ch03 - Storage and Retrieval</li></ol> </nav> <div id="main-content" class="main-content" role="main"> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <h1 id="chapter-3-storage-and-retrieval"> <a href="#chapter-3-storage-and-retrieval" aria-labelledby="chapter-3-storage-and-retrieval" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Chapter 3: Storage and retrieval </h1> <h2 id="data-structures-that-power-your-db"> <a href="#data-structures-that-power-your-db" aria-labelledby="data-structures-that-power-your-db" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data structures that power your DB </h2> <h3 id="hash-indexes"> <a href="#hash-indexes" aria-labelledby="hash-indexes" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hash indexes </h3> <ul> <li>Use log for writing key + value; key + value</li> <li>Index: Key -&gt; byte offsets mapping</li> <li>Used by - Bitcask - default storage engine for Riak - hashmap stored in memory</li> <li>Good for: value of each key is updated frequently</li> <li> <p>Log compaction: <img src="/dendron-notes/assets/images/2020-11-02-12-51-46.png" alt="" /></p> <ul> <li>Segment log files</li> <li>Keep only the most recent update for each key</li> <li>Merging and compaction is written to a new file - in background <img src="/dendron-notes/assets/images/2020-11-02-12-57-10.png" alt="" /></li> <li>After compaction, switch to new merged segment</li> </ul> </li> <li>Lookup: each segment has its own hash table. First check most recent segment for key, then prior, â€¦</li> <li>File format: binary format is more space efficient and faster than CSVs</li> <li>Deleting records: write tombstone record. During merge, discard prev entries</li> <li>Crash recovery: If the database is restarted, the in-memory hash maps are lost. Snapshot segment hashmap on disk to speed up recovery</li> <li><strong>Concurrency control: one writer thread. Because of immutability, reads can be concurrent</strong></li> <li>Limitations: <ul> <li><strong>Table must fit in memory</strong>. Not good for large number of keys. Hashmap on disk bad perf: lots of random IO</li> <li><strong>Range queries not efficient</strong></li> </ul> </li> </ul> <h3 id="sstables-and-lsm-trees"> <a href="#sstables-and-lsm-trees" aria-labelledby="sstables-and-lsm-trees" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SSTables and LSM trees </h3> <ul> <li>SSTables introduced by <a href="https://research.google/pubs/pub27898/">Google bigtable paper</a></li> <li>Sorted String table <ul> <li>each key only appears once within each merged segment</li> <li>Efficient merging <img src="/dendron-notes/assets/images/2020-11-02-13-27-23.png" alt="" /></li> <li>When write comes in - use in-memory balanced tree (i.e. memtable)</li> <li>After size too big: write to disk as SSTable file</li> <li>When read: first search in memtable, then in most recent on-disk segment, etc.</li> <li>Run merge and compaction in background</li> <li>Problem: crashes - most recent write is lost &lt;â€“ keep a separate log for each write immediately on disk</li> </ul> </li> <li>Make LSM tree (log-structured merge-tree) out of SSTables <ul> <li>keeping a cascade of SSTables that are merged in the background</li> <li>LSM storage engines: based on this principle of merging and compacting sorted files</li> <li>Performance optimizations: bad perf if key does not exist â€“ use a bloom filter</li> </ul> </li> </ul> <h2 id="b-tree"> <a href="#b-tree" aria-labelledby="b-tree" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> B-tree </h2> <ul> <li>Compared to log structed indexes : MB sized segments; B tree breaks 4KB blocks/pages. corresponds more closely to the underlying hardware. <img src="/dendron-notes/assets/images/2020-11-02-13-30-06.png" alt="" /></li> <li>Most databases can fit into a B-tree that is three or four levels</li> <li>Grow a B tree by splitting a page</li> <li>to make the database resilient to crashes: WAL - write-ahead log or redo log</li> <li>Concurrency: protect with latches</li> <li>Optimizations: <ul> <li>Use copy-on-write instead of WAL</li> <li>Abbreviating keys</li> <li>Try to keep leaf pages sequential - harder than LSM trees</li> <li>Additional pointers - such as sibling pages</li> </ul> </li> </ul> <h3 id="comparing-b-trees-and-lsm-trees"> <a href="#comparing-b-trees-and-lsm-trees" aria-labelledby="comparing-b-trees-and-lsm-trees" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Comparing B trees and LSM trees </h3> <ul> <li>LSM-trees are typically faster for writes, whereas B-trees are thought to be faster for reads - however no conclusive benchmark</li> <li>Pro of LSM trees: <ul> <li>A B-tree index must write every piece of data at least twice &amp; write an entire page at a time - write amplication</li> <li>LSM-trees are typically able to sustain higher write throughput than B- trees, partly because they sometimes have lower write amplification</li> <li>LSM-trees can be compressed better - B-tree storage engines leave some disk space unused</li> </ul> </li> <li>Con of LSM <ul> <li>compaction process can sometimes interfere with the performance of ongoing RWs - impact higher percentiles-</li> <li>If ill-configured, compaction cannot keep up with the rate of incoming writes - unmerged segments on disk keeps growing until you run out of disk space, and reads also slow down because they need to check more segment files</li> <li>B tree each key exists in exactly one place - easier for locks &amp; transaction semantics</li> </ul> </li> <li>B tree common in relational, LSM in newer DBs</li> </ul> <h3 id="other-strcutures"> <a href="#other-strcutures" aria-labelledby="other-strcutures" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Other strcutures </h3> <ul> <li>Storing values within index: <ul> <li>row is stored elsewhere (ie heapfile)</li> <li>clustered index - row with index</li> <li>In MySQL innDB - primary key is clusterd, secondary index refer to the primary key</li> <li>Compromise: include some columns - covering index</li> </ul> </li> <li>Multi-column indexes <ul> <li>Concatenated index</li> <li>Multi-dimensional index for spatial data <ul> <li>Option 1: translate 2 dimensional location into a single number using a space filling curve</li> <li>Option 2: R trees with PostgreSQLâ€™s Generalized Search Tree</li> </ul> </li> </ul> </li> <li>Full-text search and fuzzy indexes</li> <li>In memory DB: <ul> <li>performance advantage of in-memory databases is not due to the fact that they donâ€™t need to read from disk.</li> <li>But because they can avoid the overheads of encoding in-memory data structures in a form that can be written to disk</li> <li>Also offer data models difficult to implement with disk based indexes e.g. Redis</li> <li>Future: NVM (non-volatile memory)</li> </ul> </li> </ul> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"></p> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/angelarw/dendron-notes/tree/gh-pages/vault/books.tech.data-intensive-applications.ch3-DB-storage.md" id="edit-this-page">Edit this page on GitHub</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
